<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Congkak Quest - Heritage Reimagined</title>
    <link rel="icon" type="image/png" href="/assets/textures/congkak/guli_yellow.png">
    <link rel="stylesheet" href="./style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&family=Cormorant+Garamond:ital,wght@0,500;0,700;1,500&family=Nunito:wght@600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <!-- Preloader -->
    <div id="preloader"
        style="position:fixed;top:0;left:0;width:100%;height:100%;background:#1a0e07;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;transition:opacity 0.5s ease;">
        <div
            style="width:80px;height:80px;border:5px solid var(--primary-dark);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite;">
        </div>
        <h2 style="font-family:var(--font-heading);color:var(--primary);margin-top:20px;letter-spacing:4px;">LOADING...
        </h2>
        <style>
            @keyframes spin {
                to {
                    transform: rotate(360deg)
                }
            }
        </style>
    </div>

    <div id="game-container">
        <canvas id="bg"></canvas>
        <div id="joystick-zone" class="hidden"></div>
        <div id="crosshair"></div>
        <div id="help-hint-container">
            <div id="mouse-hint" class="hidden">Hold Left-Click to rotate | Scroll to zoom</div>
            <button id="help-btn" class="help-btn">?</button>
        </div>
        <div id="recharge-flash" class="recharge-flash"></div>
        <div id="energy-popup" class="energy-recharge-popup">ENERGY RECHARGE! ‚ö°</div>

        <!-- UI Overlay -->
        <div id="ui-layer">

            <!-- ======== TOP STATUS BAR ======== -->
            <div id="top-bar" class="hidden">
                <div class="top-bar-left">
                    <div class="profile-pill">
                        <img id="avatar-icon" src="/assets/textures/player/player_face.png" alt="Avatar"
                            class="avatar-icon">
                        <span id="player-name" class="player-name">Player</span>
                    </div>
                    <button id="hud-toggle-btn" class="hud-toggle-btn"><i data-lucide="eye"></i></button>
                    <button id="google-login-btn"
                        style="cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;padding:0 18px;border-radius:30px;border:2px solid var(--primary);background:white;color:#333;font-family:inherit;font-size:0.75rem;font-weight:900;letter-spacing:1px;box-shadow:0 0 15px rgba(255,184,0,0.3);white-space:nowrap;height:38px;width:130px;align-self:center;margin-left:5px">
                        <i data-lucide="key" style="width:16px;height:16px"></i>
                        <span>LOG IN</span></button>
                    <button id="logout-btn" class="hidden"
                        style="cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;padding:0 18px;border-radius:30px;border:2px solid #ff4d4f;background:rgba(20, 10, 5, 0.6);color:#fff;font-family:inherit;font-size:0.75rem;font-weight:900;letter-spacing:1px;box-shadow:0 0 15px rgba(255,77,79,0.2);backdrop-filter:blur(5px);white-space:nowrap;height:38px;width:130px;align-self:center;margin-left:5px">
                        <i data-lucide="log-out" style="width:16px;height:16px"></i>
                        <span class="logout-text">LOG OUT</span></button>
                </div>

                <div class="top-bar-center">
                    <nav class="top-nav">
                        <button class="top-nav-btn nav-link-play" id="nav-play">
                            <span class="top-nav-icon">üé≤</span>
                            <span class="top-nav-label">PLAY</span>
                        </button>
                        <button class="top-nav-btn nav-link-map" id="nav-map">
                            <span class="top-nav-icon">üó∫Ô∏è</span>
                            <span class="top-nav-label">MAP</span>
                        </button>
                        <button class="top-nav-btn nav-link-inventory" id="nav-inventory">
                            <span class="top-nav-icon">üéí</span>
                            <span class="top-nav-label">BAG</span>
                            <span class="notif-dot"></span>
                        </button>
                        <button class="top-nav-btn nav-link-missions" id="nav-missions">
                            <span class="top-nav-icon">üìú</span>
                            <span class="top-nav-label">QUEST</span>
                            <span class="notif-dot active"></span>
                        </button>
                        <button class="top-nav-btn nav-link-rank" id="nav-rank">
                            <span class="top-nav-icon">üèÜ</span>
                            <span class="top-nav-label">RANK</span>
                        </button>
                        <button class="top-nav-btn nav-link-history" id="nav-history">
                            <span class="top-nav-icon">üìú</span>
                            <span class="top-nav-label">HISTORY</span>
                        </button>
                        <button class="top-nav-btn nav-link-joystick" id="nav-joystick">
                            <span class="top-nav-icon">üïπÔ∏è</span>
                            <span class="top-nav-label">CONTROL</span>
                        </button>
                    </nav>
                </div>

                <div class="top-bar-right">
                    <div class="resource-pill xp-pill">
                        <span class="res-icon">üåü</span>
                        <span id="xp-val" class="res-val">0 XP</span>
                    </div>
                    <div class="resource-pill energy-pill">
                        <span class="res-icon">‚ö°</span>
                        <span id="energy-val" class="res-val">100</span>
                    </div>
                    <div class="resource-pill coin-pill">
                        <span class="res-icon">ü™ô</span>
                        <span id="coin-val" class="res-val">0</span>
                    </div>
                    <div class="resource-pill guli-pill">
                        <span class="res-icon">üîÆ</span>
                        <span id="guli-val" class="res-val">0 guli</span>
                    </div>
                    <span id="level-val" style="display:none">1</span>
                </div>
            </div>

            <!-- ======== HUD (Explore & Congkak) ======== -->
            <div id="hud" class="hidden">
                <!-- World Map HUD Panel -->
                <div id="world-map" class="bounty-panel">
                    <div class="bounty-header">
                        <span class="bounty-icon">üó∫Ô∏è</span>
                        <h4 class="bounty-title">VILLAGE MAP</h4>
                    </div>
                    <div class="level-path-mini">
                        <div class="level-node-mini active" data-level="0">
                            <div class="node-circle-mini">1</div>
                            <img src="/assets/textures/player/tok_aki_face.png" class="map-face-mini">
                            <span class="node-label-mini">Tok Aki</span>
                        </div>
                        <div class="path-line-mini"></div>
                        <div class="level-node-mini locked" data-level="1">
                            <div class="node-circle-mini">2</div>
                            <img src="/assets/textures/player/player_face.png" class="map-face-mini">
                            <span class="node-label-mini">Nek Senah</span>
                        </div>
                        <div class="path-line-mini"></div>
                        <div class="level-node-mini locked" data-level="2">
                            <div class="node-circle-mini">3</div>
                            <img src="/assets/textures/player/player_face.png" class="map-face-mini">
                            <span class="node-label-mini">Pak Abu</span>
                        </div>
                    </div>
                </div>

                <!-- Bounty Board / Quest Panel -->
                <div id="bounty-hud" class="bounty-panel">
                    <div class="bounty-header">
                        <span class="bounty-icon">üìú</span>
                        <h4 class="bounty-title">MISSIONS</h4>
                        <span class="notif-badge">!</span>
                    </div>
                    <ul id="quest-list" class="quest-list">
                        <li id="quest-guli" class="active">
                            <div class="quest-row">
                                <div class="quest-info">
                                    <span class="quest-icon">üîÆ</span>
                                    <span>Collect 49 Gulis</span>
                                </div>
                                <span id="guli-ready-indicator" class="ready-notif hidden">READY!</span>
                            </div>
                            <button id="start-congkak-btn" class="btn challenge-btn hidden">CHALLENGE TOK AKI</button>
                        </li>
                        <li id="quest-congkak" class="locked">
                            <span class="quest-icon">üé≤</span>
                            <span>Defeat Tok Aki in Congkak</span>
                        </li>
                    </ul>
                </div>

                <!-- Guli Bag / Vault HUD -->
                <div id="guli-vault-mini" class="bounty-panel">
                    <div class="bounty-header">
                        <span class="bounty-icon">üîÆ</span>
                        <h4 class="bounty-title">GULI BAG</h4>
                    </div>
                    <div class="vault-grid-mini">
                        <div class="vault-item-mini black-glow">
                            <img src="/assets/textures/congkak/guli_black.png">
                            <span id="vault-black-mini" class="vault-count">0</span>
                        </div>
                        <div class="vault-item-mini blue-glow">
                            <img src="/assets/textures/congkak/guli_blue.png">
                            <span id="vault-blue-mini" class="vault-count">0</span>
                        </div>
                        <div class="vault-item-mini yellow-glow">
                            <img src="/assets/textures/congkak/guli_yellow.png">
                            <span id="vault-yellow-mini" class="vault-count">0</span>
                        </div>
                        <div class="vault-item-mini red-glow">
                            <img src="/assets/textures/congkak/guli_red.png">
                            <span id="vault-red-mini" class="vault-count">0</span>
                        </div>
                        <div class="vault-item-mini white-glow">
                            <img src="/assets/textures/congkak/guli_white.png">
                            <span id="vault-white-mini" class="vault-count">0</span>
                        </div>
                    </div>
                </div>

                <!-- Leaderboard HUD Panel -->
                <div id="leaderboard-panel" class="bounty-panel">
                    <div class="bounty-header">
                        <span class="bounty-icon">üèÜ</span>
                        <h4 class="bounty-title">LEADERBOARD</h4>
                    </div>
                    <div class="leaderboard-scroll-container"
                        style="width:100%; overflow-x:auto;-webkit-overflow-scrolling:touch;">
                        <table
                            style="width:100%;min-width:320px;border-collapse:collapse;text-align:left;font-size:0.75rem; white-space: nowrap;">
                            <thead>
                                <tr style="border-bottom:2px solid var(--primary);color:var(--primary)">
                                    <th style="padding:6px 4px">#</th>
                                    <th style="padding:6px 4px">PEMAIN</th>
                                    <th style="padding:6px 4px">XP</th>
                                    <th style="padding:6px 4px">SKOR</th>
                                    <th style="padding:6px 4px">W/L</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboard-body">
                                <tr>
                                    <td colspan="5" style="padding:12px;text-align:center;opacity:0.5">Tiada data lagi
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- History HUD Panel -->
                <div id="history-panel" class="bounty-panel hidden">
                    <div class="bounty-header">
                        <span class="bounty-icon">üìú</span>
                        <h4 class="bounty-title">MATCH HISTORY</h4>
                    </div>
                    <div class="leaderboard-scroll-container" style="width:100%; overflow-x:auto;">
                        <table
                            style="width:100%; border-collapse:collapse; text-align:left; font-size:0.7rem; white-space: nowrap;">
                            <thead>
                                <tr style="border-bottom:1px solid var(--primary); color:var(--primary)">
                                    <th style="padding:4px">DATE</th>
                                    <th style="padding:4px">RESULT</th>
                                    <th style="padding:4px">SCORE</th>
                                    <th style="padding:4px">REWARD</th>
                                </tr>
                            </thead>
                            <tbody id="history-body">
                                <tr>
                                    <td colspan="4" style="padding:12px; text-align:center; opacity:0.5">Tiada rekod
                                        lagi</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Congkak HUD -->

            </div> <!-- End HUD -->

            <!-- ======== 2D CONGKAK OVERLAY (Modal) ======== -->
            <div id="congkak-2d-overlay" class="overlay hidden">
                <div class="menu-content congkak-paper-modal">
                    <button id="exit-congkak-btn" class="map-close-btn">‚úò</button>
                    <h2 class="heritage-heading">Congkak Challenge</h2>

                    <div class="congkak-interaction-area">
                        <div class="board-2d-container">
                            <!-- AI Row (Top) -->
                            <div class="board-row ai-row">
                                <div id="hole-13-2d" class="hole-2d"><span class="hole-seeds">0</span></div>
                                <div id="hole-12-2d" class="hole-2d"><span class="hole-seeds">0</span></div>
                                <div id="hole-11-2d" class="hole-2d"><span class="hole-seeds">0</span></div>
                                <div id="hole-10-2d" class="hole-2d"><span class="hole-seeds">0</span></div>
                                <div id="hole-9-2d" class="hole-2d"><span class="hole-seeds">0</span></div>
                                <div id="hole-8-2d" class="hole-2d"><span class="hole-seeds">0</span></div>
                                <div id="hole-7-2d" class="hole-2d"><span class="hole-seeds">0</span></div>
                            </div>

                            <!-- Player Row (Bottom) -->
                            <div class="board-row player-row">
                                <div id="hole-0-2d" class="hole-2d player-hole"><span class="hole-seeds">0</span></div>
                                <div id="hole-1-2d" class="hole-2d player-hole"><span class="hole-seeds">0</span></div>
                                <div id="hole-2-2d" class="hole-2d player-hole"><span class="hole-seeds">0</span></div>
                                <div id="hole-3-2d" class="hole-2d player-hole"><span class="hole-seeds">0</span></div>
                                <div id="hole-4-2d" class="hole-2d player-hole"><span class="hole-seeds">0</span></div>
                                <div id="hole-5-2d" class="hole-2d player-hole"><span class="hole-seeds">0</span></div>
                                <div id="hole-6-2d" class="hole-2d player-hole"><span class="hole-seeds">0</span></div>
                            </div>

                            <!-- Stores -->
                            <div id="hole-15-2d" class="store-2d store-left"><span class="store-seeds">0</span></div>
                            <div id="hole-14-2d" class="store-2d store-right"><span class="store-seeds">0</span></div>

                            <div class="board-label">MALAY HERITAGE CONGKAK</div>
                        </div>
                    </div>


                    <!-- HUD integrated into modal -->
                    <div id="congkak-hud-internal" class="congkak-hud-modal">
                        <div class="congkak-scores">
                            <div class="score-wrapper you">
                                <div class="avatar-box">
                                    <img id="player-avatar" src="/assets/textures/player/player_face.png"
                                        class="congkak-avatar" alt="You">
                                    <div id="p1-turn-indicator" class="turn-status-label active">YOUR TURN</div>
                                </div>
                                <div class="score-chip">
                                    <span class="score-label">YOU</span>
                                    <span id="p1-score" class="score-num">0</span>
                                </div>
                            </div>
                            <div class="congkak-center-stat">
                                <span class="vs-text">VS</span>
                                <div id="game-status" class="status-pill">YOUR TURN</div>
                            </div>
                            <div class="score-wrapper ai">
                                <div class="score-chip">
                                    <span class="score-label">TOK AKI</span>
                                    <span id="ai-score" class="score-num">0</span>
                                </div>
                                <div class="avatar-box">
                                    <img id="ai-avatar" src="/assets/textures/player/tok_aki_face.png"
                                        class="congkak-avatar" alt="Tok Aki">
                                    <div id="ai-turn-indicator" class="turn-status-label">TOK AKI'S TURN</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Inspector -->
                    <div id="hole-inspector" class="hole-inspector-bottom">
                        <div id="inspector-content" class="inspector-content-row">
                            <span class="inspector-hint">HOVER OVER A HOLE TO VIEW GULI DETAILS</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ======== MAIN MENU / TITLE SCREEN ======== -->
            <div id="main-menu" class="overlay">
                <div class="menu-content main-menu-scroll">
                    <h1 class="glitch-text">CONGKAK QUEST</h1>
                    <p class="subtitle italic">Heritage Reimagined</p>
                    <div class="instructions-mobile-wrap">
                        <div class="instructions">
                            <div class="power-item">
                                <img src="/assets/textures/congkak/guli_blue.png" class="guli-icon"> <span><b>Blue:</b>
                                    Steal 3 Gulis</span>
                            </div>
                            <div class="power-item">
                                <img src="/assets/textures/congkak/guli_yellow.png" class="guli-icon">
                                <span><b>Yellow:</b> Double Points</span>
                            </div>
                            <div class="power-item">
                                <img src="/assets/textures/congkak/guli_red.png" class="guli-icon"> <span><b>Red:</b>
                                    Speed Boost</span>
                            </div>
                            <div class="power-item">
                                <img src="/assets/textures/congkak/guli_white.png" class="guli-icon">
                                <span><b>White:</b> Guli Magnet</span>
                            </div>
                        </div>
                    </div>
                    <button id="start-btn" class="primary-btn">START</button>
                </div>
            </div>



            <!-- ======== MINIGAME SELECTION ======== -->
            <div id="game-selector" class="overlay hidden">
                <div class="menu-content">
                    <h2 class="heritage-heading">Collect Gulis</h2>
                    <p class="subtitle italic">Choose your path to the championship</p>
                    <div class="selection-grid">
                        <div id="select-quiz" class="select-card">
                            <div class="card-icon">üìú</div>
                            <h3>Heritage Quiz</h3>
                            <p>Answer questions about Congkak.</p>
                        </div>
                        <div id="select-match3" class="select-card">
                            <div class="card-icon">üîÆ</div>
                            <h3>Guli Match</h3>
                            <p>Match 3 or more Gulis.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ======== QUIZ ======== -->
            <div id="quiz-game" class="overlay hidden">
                <div class="menu-content quiz-box">
                    <div id="quiz-question-num">Question 1/5</div>
                    <h2 id="quiz-question">What is a small hole in Congkak called?</h2>
                    <div id="quiz-options" class="options-grid"></div>
                </div>
            </div>

            <!-- ======== MATCH-3 ======== -->
            <div id="match3-game" class="overlay hidden">
                <div class="menu-content match3-box">
                    <div class="match3-header">
                        <span>GOAL: <b id="match3-target">0 / 50</b></span>
                        <button id="match3-exit" class="small-btn">EXIT</button>
                    </div>
                </div>
            </div> <!-- end match3-game -->

            <!-- ======== DIFFICULTY SELECTOR ======== -->
            <div id="difficulty-selector" class="overlay hidden">
                <div class="menu-content difficulty-content">
                    <button id="close-diff-btn" class="map-close-btn">‚úò</button>
                    <h2 class="heritage-heading small">CHOOSE CHALLENGE</h2>
                    <p class="difficulty-hint">How tough is Tok Aki today?</p>
                    <div class="difficulty-options">
                        <div class="difficulty-card easy" data-level="easy">
                            <div class="diff-icon">üë¥</div>
                            <h3>Easy</h3>
                            <p class="reward-hint">Win: +50 ü™ô</p>
                        </div>
                        <div class="difficulty-card normal" data-level="normal">
                            <div class="diff-icon">üëµ</div>
                            <h3>Normal</h3>
                            <p class="reward-hint">Win: +100 ü™ô</p>
                        </div>
                        <div class="difficulty-card hard" data-level="hard">
                            <div class="diff-icon">üî•</div>
                            <h3>Hard</h3>
                            <p class="reward-hint">Win: +150 ü™ô</p>
                        </div>
                    </div>
                    <p class="penalty-hint">Penalty for losing: -10 ü™ô</p>
                </div>
            </div>

            <!-- ======== WIN SCREEN ======== -->
            <div id="win-screen" class="overlay hidden">
                <div class="win-panel">
                    <div class="win-stars">‚òÖ‚òÖ‚òÖ</div>
                    <h2 id="win-msg" class="win-title">VICTORY!</h2>
                    <p class="win-sub">You have mastered this level.</p>
                    <div class="win-rewards">
                        <div class="reward-item">ü™ô +50</div>
                        <div class="reward-item">‚ö° +5</div>
                    </div>
                    <button id="next-level-btn" class="primary-btn">NEXT LEVEL</button>
                </div>
            </div>

            <!-- ======== STORY / DIALOGUE OVERLAY ======== -->
            <div id="story-overlay" class="overlay hidden">
                <div class="story-container">
                    <div class="portrait-container">
                        <img id="story-portrait" src="/assets/textures/player/player_face.png" alt="Portrait">
                    </div>
                    <div id="story-content" class="story-box ui-interactable">
                        <div class="story-controls">
                            <button id="story-skip">SKIP</button>
                            <button id="story-next">NEXT ‚ûî</button>
                        </div>
                        <h4 id="story-name" class="story-name">Tok Aki</h4>
                        <p id="story-text"></p>
                    </div>
                </div>
            </div>

            <!-- ======== SCAM OVERLAY ======== -->
            <div id="scam-overlay" class="overlay hidden">
                <div class="scam-box">
                    <div class="scam-animal">üêí</div>
                    <div class="scam-msg">BOO KENA SCAM!</div>
                    <p>Ini bukan guli sebenar...</p>
                    <button id="scam-close" class="primary-btn">Aduhai...</button>
                </div>
            </div>

            <!-- ======== MOBILE HUB MENU ======== -->
            <div id="mobile-hub-menu" class="overlay hidden">
                <div class="hub-container">
                    <h3 class="hub-title">CONTROL CENTER</h3>
                    <div class="hub-grid">
                        <button class="hub-item nav-link-missions">
                            <span class="hub-icon"><i data-lucide="scroll"></i></span>
                            <span class="hub-label">QUESTS</span>
                        </button>
                        <button class="hub-item nav-link-rank">
                            <span class="hub-icon"><i data-lucide="trophy"></i></span>
                            <span class="hub-label">RANKINGS</span>
                        </button>
                        <button class="hub-item nav-link-joystick">
                            <span class="hub-icon"><i data-lucide="gamepad-2"></i></span>
                            <span class="hub-label">JOYSTICK</span>
                        </button>
                        <button class="hub-item nav-link-help">
                            <span class="hub-icon"><i data-lucide="help-circle"></i></span>
                            <span class="hub-label">GUIDE</span>
                        </button>
                    </div>
                    <button id="close-hub-btn" class="hub-close">CLOSE</button>
                </div>
            </div>

            <!-- ======== MOBILE BOTTOM NAV ======== -->
            <div id="mobile-bottom-nav">
                <button class="mobile-nav-item nav-link-play">
                    <span class="mobile-nav-icon"><i data-lucide="play-circle"></i></span>
                    <span class="mobile-nav-label">PLAY</span>
                </button>
                <button class="mobile-nav-item nav-link-map">
                    <span class="mobile-nav-icon"><i data-lucide="map"></i></span>
                    <span class="mobile-nav-label">MAP</span>
                </button>
                <div class="mobile-hub-trigger" id="hub-trigger-btn">
                    <div class="hub-btn-inner">
                        <span class="hub-main-icon"><i data-lucide="layout-grid"></i></span>
                    </div>
                    <span class="mobile-nav-label" style="margin-top:4px">HUB</span>
                </div>
                <button class="mobile-nav-item nav-link-inventory">
                    <span class="mobile-nav-icon"><i data-lucide="shopping-bag"></i></span>
                    <span class="mobile-nav-label">BAG</span>
                </button>
                <button class="mobile-nav-item nav-link-history">
                    <span class="mobile-nav-icon"><i data-lucide="history"></i></span>
                    <span class="mobile-nav-label">RECORDS</span>
                </button>
            </div>

        </div> <!-- end ui-layer -->


        <script type="module" src="/main.js"></script>
</body>

</html>